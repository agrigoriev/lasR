<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pipelines â€¢ lasR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pipelines">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lasR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Presentation</h6></li>
    <li><a class="dropdown-item" href="../articles/why.html">Why lasR?</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks of lasR vs. lidR</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html">Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/multithreading.html">Parallel processing</a></li>
    <li><a class="dropdown-item" href="../articles/r-stages.html">R stages</a></li>
    <li><a class="dropdown-item" href="../articles/baba.html">Buffered Area Based Approach</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ressources</h6></li>
    <li><a class="dropdown-item" href="../articles/pipeline.html">Pipelines</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lidar/lasR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pipelines</h1>
                        <h4 data-toc-skip class="author">Jean-Romain
Roussel</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lidar/lasR/blob/main/vignettes/pipeline.Rmd" class="external-link"><code>vignettes/pipeline.Rmd</code></a></small>
      <div class="d-none name"><code>pipeline.Rmd</code></div>
    </div>

    
    
<p>After reading the <a href="tutorial.html">tutorial</a>, one may have
noticed that writing certain pipelines can be tedious, especially when
normalizing a dataset, which always implies using the same code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">&lt;-</span> <span class="va">tri</span> <span class="op">+</span> <span class="va">trans</span></span></code></pre></div>
<p>This vignette shows a list of pipeline factories, i.e., functions
that generate useful pieces of pipelines that can be reused. It also
defines some functions that execute a pipeline, which may be regularly
useful instead of writing it out. The lists are not comprehensive and
will be updated if good tools come to mind. Some are already installed
natively in the package.</p>
<div class="section level2">
<h2 id="pipeline-factories">Pipeline factories<a class="anchor" aria-label="anchor" href="#pipeline-factories"></a>
</h2>
<div class="section level3">
<h3 id="normalize">Normalize<a class="anchor" aria-label="anchor" href="#normalize"></a>
</h3>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
This pipeline is already installed in the package.
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normalize</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">extrabytes</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="va">tri</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">extrabytes</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">extra</span> <span class="op">=</span> <span class="fu"><a href="../reference/add_extrabytes.html">add_extrabytes</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"HAG"</span>, <span class="st">"Height Above Ground"</span><span class="op">)</span></span>
<span>    <span class="va">trans</span> <span class="op">=</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span>, store_in_attribute <span class="op">=</span> <span class="st">"HAG"</span><span class="op">)</span></span>
<span>    <span class="va">pipeline</span> <span class="op">=</span> <span class="va">pipeline</span> <span class="op">+</span> <span class="va">extra</span> <span class="op">+</span> <span class="va">trans</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">trans</span> <span class="op">=</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span><span class="op">)</span></span>
<span>    <span class="va">pipeline</span> <span class="op">=</span> <span class="va">pipeline</span> <span class="op">+</span> <span class="va">trans</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pipeline</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It can be used this way</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu">reader</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="classify-ground">Classify ground<a class="anchor" aria-label="anchor" href="#classify-ground"></a>
</h3>
<div class="section level4">
<h4 id="with-csf">With CSF<a class="anchor" aria-label="anchor" href="#with-csf"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ground_csf</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">smooth</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">resolution</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">rigidness</span> <span class="op">=</span> <span class="fl">1L</span>, <span class="va">iterations</span> <span class="op">=</span> <span class="fl">500L</span>, <span class="va">step</span> <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">csf</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">smooth</span>, <span class="va">threshold</span>, <span class="va">resolution</span>, <span class="va">rigidness</span>, <span class="va">iterations</span>, <span class="va">step</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">id</span> <span class="op">=</span> <span class="fu">RCSF</span><span class="fu">::</span><span class="fu">CSF</span><span class="op">(</span><span class="va">data</span>, <span class="va">smooth</span>, <span class="va">threshold</span>, <span class="va">resolution</span>, <span class="va">rigidness</span>, <span class="va">iterations</span>, <span class="va">step</span><span class="op">)</span></span>
<span>    <span class="va">class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">class</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2L</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">Classification</span> <span class="op">&lt;-</span> <span class="va">class</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">classify</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">csf</span>, expose <span class="op">=</span> <span class="st">"xyz"</span>, smooth <span class="op">=</span> <span class="va">smooth</span>, threshold <span class="op">=</span> <span class="va">threshold</span>, resolution <span class="op">=</span> <span class="va">resolution</span>, rigidness <span class="op">=</span> <span class="va">rigidness</span>, iterations <span class="op">=</span> <span class="va">iterations</span>, step <span class="op">=</span> <span class="va">step</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">classify</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu">reader</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ground_csf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="with-mcc">With MCC<a class="anchor" aria-label="anchor" href="#with-mcc"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ground_mcc</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span> <span class="op">=</span> <span class="fl">1.5</span>, <span class="va">t</span> <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">csf</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">s</span>, <span class="va">t</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">id</span> <span class="op">=</span> <span class="fu">RMCC</span><span class="fu">::</span><span class="fu">MCC</span><span class="op">(</span><span class="va">data</span>, <span class="va">s</span>, <span class="va">t</span><span class="op">)</span></span>
<span>    <span class="va">class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">class</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2L</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">Classification</span> <span class="op">&lt;-</span> <span class="va">class</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">classify</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">csf</span>, expose <span class="op">=</span> <span class="st">"xyz"</span>, s <span class="op">=</span> <span class="va">s</span>, t <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">classify</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu">reader</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ground_mcc</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span></code></pre></div>
<blockquote style="background-color: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; font-size: 14px; border-radius: 5px;">
These pipelines use <code><a href="../reference/callback.html">callback()</a></code> that exposes the point cloud
as a <code>data.frame</code>. One of the reasons why <code>lasR</code>
is more memory-efficient and faster than <code>lidR</code> is that it
<strong>does not</strong> expose the point cloud as a
<code>data.frame</code>. Thus, these pipelines are not very different
from the <code>classify_ground()</code> function in <code>lidR</code>.
The advantage of using <code>lasR</code> here is the ability to pipe
different stages.
</blockquote>
</div>
</div>
<div class="section level3">
<h3 id="canopy-heigh-model">Canopy Heigh Model<a class="anchor" aria-label="anchor" href="#canopy-heigh-model"></a>
</h3>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
These two pipelines are natively installed in the package under the name
<code><a href="../reference/chm.html">chm()</a></code>.
</blockquote>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chm_p2r</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">filter</span> <span class="op">=</span> <span class="st">""</span>, <span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"max"</span>, filter <span class="op">=</span> <span class="va">filter</span>, ofile <span class="op">=</span> <span class="va">ofile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chm_tin</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">tin</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_first</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">chm</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">tin</span>, ofile <span class="op">=</span> <span class="va">ofile</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tin</span><span class="op">+</span><span class="va">chm</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="digital-terrain-model">Digital Terrain Model<a class="anchor" aria-label="anchor" href="#digital-terrain-model"></a>
</h3>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
This one is also natively installed in the package.
</blockquote>
<p><code>add_class</code> can be used to add a class used as ground such
as 9 for water.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtm</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>, <span class="va">add_class</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">filter</span> <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">add_class</span><span class="op">)</span><span class="op">)</span> <span class="va">filter</span> <span class="op">=</span> <span class="va">filter</span> <span class="op">+</span> <span class="fu"><a href="../reference/filters.html">keep_class</a></span><span class="op">(</span><span class="va">add_class</span><span class="op">)</span></span>
<span>  <span class="va">tin</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="va">filter</span><span class="op">)</span></span>
<span>  <span class="va">chm</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">tin</span>, ofile <span class="op">=</span> <span class="va">ofile</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tin</span><span class="op">+</span><span class="va">chm</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="useful-functions">Useful functions<a class="anchor" aria-label="anchor" href="#useful-functions"></a>
</h2>
<div class="section level3">
<h3 id="read-las">Read LAS<a class="anchor" aria-label="anchor" href="#read-las"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_las</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span>, <span class="va">select</span> <span class="op">=</span> <span class="st">"xyzi"</span>, <span class="va">filter</span> <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">load</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">}</span></span>
<span>  <span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="va">filter</span><span class="op">)</span></span>
<span>  <span class="va">call</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">load</span>, expose <span class="op">=</span> <span class="va">select</span>, no_las_update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">call</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="buffer-tiles">Buffer tiles<a class="anchor" aria-label="anchor" href="#buffer-tiles"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buffer_tiles</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span>, <span class="va">buffer</span>, <span class="va">ofiles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/*_buffered.las"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">write</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">ofiles</span>, keep_buffer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">write</span>, on <span class="op">=</span> <span class="va">files</span>, buffer <span class="op">=</span> <span class="va">buffer</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clip-circle">Clip circle<a class="anchor" aria-label="anchor" href="#clip-circle"></a>
</h3>
<p>Writes LAS files or returns <code>data.frame</code>s. Supports
<code>sf</code> objects as input.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clip_circle</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span>, <span class="va">geometry</span>, <span class="va">radius</span>, <span class="va">ofiles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/*_clipped.las"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">st_geometry_type</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="cn">FALSE</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"POINT"</span><span class="op">)</span> </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Expected POINT geometry type"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span>  <span class="va">xcenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">ycenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="va">xcenter</span>, yc <span class="op">=</span> <span class="va">ycenter</span>, r <span class="op">=</span> <span class="va">radius</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ofiles</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span> <span class="op">&amp;&amp;</span> <span class="va">ofiles</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="va">stage</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">}</span>, expose <span class="op">=</span> <span class="st">"*"</span>, no_las_update <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">stage</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">ofiles</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">stage</span>, on <span class="op">=</span> <span class="va">files</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="crs">CRS<a class="anchor" aria-label="anchor" href="#crs"></a>
</h3>
<p>A CRS as <code>sf</code> object. The cost of applying
<code><a href="../reference/hulls.html">hulls()</a></code> is virtually null.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crs</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hulls.html">hulls</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">files</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inventory-metrics">Inventory metrics<a class="anchor" aria-label="anchor" href="#inventory-metrics"></a>
</h3>
<p>Using an <code>sf</code> object to provide plot centers and offering
the option to normalize on-the-fly. It returns the same <code>sf</code>
object with extra attributes.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inventory_metrics</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span>, <span class="va">geometry</span>, <span class="va">radius</span>, <span class="va">fun</span>, <span class="va">normalize</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">st_geometry_type</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="cn">FALSE</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"POINT"</span><span class="op">)</span> </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Expected POINT geometry type"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span>  <span class="va">xcenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">ycenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="va">xcenter</span>, yc <span class="op">=</span> <span class="va">ycenter</span>, r <span class="op">=</span> <span class="va">radius</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">normalize</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span><span class="op">)</span></span>
<span>    <span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="va">pipeline</span> <span class="op">+</span> <span class="va">tri</span> <span class="op">+</span> <span class="va">trans</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="va">pipeline</span> <span class="op">+</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">fun</span>, expose <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span></span>
<span>  <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">files</span><span class="op">)</span></span>
<span>  <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ans</span>, <span class="va">as.data.frame</span><span class="op">)</span></span>
<span>  <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">ans</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="va">ans</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="virtual-point-cloud">Virtual point cloud<a class="anchor" aria-label="anchor" href="#virtual-point-cloud"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">build_vpc</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span>, <span class="va">ofile</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">write</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_vpc.html">write_vpc</a></span><span class="op">(</span><span class="va">ofile</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">write</span>, on <span class="op">=</span> <span class="va">files</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jean-Romain Roussel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
